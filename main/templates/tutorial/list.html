<p>
  In order to present the contacts we will have to do three things: create the
  handler that will retrieve the contacts from the datastore, the template to
  present them in the browser and the link on the top bar to access this list.
</p>


<h3>Contact List Handler</h3>

<p>
  Add the following code to the <code>contact.py</code> file:
</p>

<pre class="prettyprint linenums lang-python">
import util

@app.route('/contact/')
@auth.login_required
def contact_list():
  contact_dbs, more_cursor = util.retrieve_dbs(
      model.Contact.query(),
      limit=util.param('limit', int),
      cursor=util.param('cursor'),
      order=util.param('order') or 'name',
    )
  return flask.render_template(
      'contact_list.html',
      html_class='contact-list',
      title='Contact List',
      contact_dbs=contact_dbs,
      more_url=util.generate_more_url(more_cursor),
    )
</pre>


<h3>Contact List Template</h3>

<p>
  After creating the handler, we are going to need a template to be able to
  present a table of all the contacts that we've added so far. Create a new file
  <code>contact_list.html</code> in the <code>templates</code> directory
  and paste the following code there:
</p>

<pre class="prettyprint linenums lang-html">
&#35; extends 'base.html'

&#35; block content
  &lt;div class="page-header"&gt;
    &lt;h1&gt;&#123;&#123;title&#125;&#125;&lt;/h1&gt;
  &lt;/div&gt;
  &lt;table class="table table-bordered"&gt;
    &lt;thead&gt;
      &lt;tr&gt;
        &lt;th&gt;ID&lt;/th&gt;
        &lt;th&gt;Name&lt;/th&gt;
        &lt;th&gt;Email&lt;/th&gt;
        &lt;th&gt;Phone&lt;/th&gt;
        &lt;th&gt;Address&lt;/th&gt;
      &lt;/tr&gt;
    &lt;/thead&gt;
    &lt;tbody&gt;
      &#35; for contact_db in contact_dbs
        &lt;tr&gt;
          &lt;td&gt;&#123;&#123;contact_db.key.id()&#125;&#125;&lt;/td&gt;
          &lt;td&gt;&#123;&#123;contact_db.name&#125;&#125;&lt;/td&gt;
          &lt;td&gt;&#123;&#123;contact_db.email&#125;&#125;&lt;/td&gt;
          &lt;td&gt;&#123;&#123;contact_db.phone&#125;&#125;&lt;/td&gt;
          &lt;td&gt;&#123;&#123;contact_db.address&#125;&#125;&lt;/td&gt;
        &lt;/tr&gt;
      &#35; endfor
    &lt;/tbody&gt;
  &lt;/table&gt;
&#35; endblock
</pre>

<p>
  You can test the handler and the above template by visiting the url
  <a href="http://localhost:8080/contact/">http://localhost:8080/contact/</a>,
  but in the next section we'll add a link to make it easier to access.
</p>


<h3>Finalise Contact Listing</h3>

<p>
  As a final touch we're going to do two things: adding the link in the top bar
  and changing the redirect after creating the contact to take us to the this
  list instead of going back to the welcome page.
</p>


<h4>Adding a link on the top bar</h4>

<p>
  Add the lines <code>3 - 5</code> inside the
  <code>&lt;ul class="nav"&gt;...&lt;/ul&gt;</code> element that you will find in the
  <code>header.html</code> file that is located in the
  <code>templates/bit</code> directory.
</p>


<pre class="prettyprint linenums lang-html">
&lt;ul class="nav"&gt;
  ...
  &lt;li class="&#123;&#123;'active' if html_class == 'contact-list'&#125;&#125;"&gt;
    &lt;a href="&#123;&#123;url_for('contact_list')&#125;&#125;"&gt;&lt;i class="fa fa-list"&gt;&lt;/i&gt; Contact List&lt;/a&gt;
  &lt;/li&gt;
  ...
&lt;/ul&gt;
</pre>

<p>
  After refreshing the page
  (<a href="http://localhost:8080/">http://localhost:8080/</a>),
  you should be able to see the link on the top
  and if you're in watching the contact list it should also be <code>active</code>.
</p>

<h4>Changing the redirect</h4>

<p>
  After creating a new contact we will now redirect the user to the contact
  list instead of the welcome page and also and also show her a message that
  the new contact was successfully created.
</p>

<p>
  Find the following line in the contat_create handler:
</p>

<pre class="prettyprint">
return flask.redirect(flask.url_for('welcome'))
</pre>

and replace it with the following:

<pre class="prettyprint linenums">
flask.flash('New contact was successfully created!', category='success')
return flask.redirect(flask.url_for('contact_list', order='-created'))
</pre>

<p>
  The first line is to flash the message that the creation was successful.
  The argument <code>category</code> is optional and can be one of the
  following: <code>warning</code> (default), <code>danger</code>,
  <code>success</code> or <code>info</code>.
</p>

<p>
  In the second line notice that we are using the <code>order='-created'</code>
  in the <code>url_for</code> function, which will be translated to:
  <a href="http://localhost:8080/contact/?order=-created">http://localhost:8080/contact/?order=-created</a>.
  You can choose whatever order you like and you can also play with the url
  by providing different orders for the fields that you have in the
  <code>Contact</code> model. Use the <code>-</code> if you want the inverse
  order and <code>,</code> to combine more than one field for order.
</p>

<p class="alert alert-warning hide">
  Extarnal reading:
  <a class="alert-link" href="http://flask.pocoo.org/docs/patterns/flashing/">flask.flash</a>,
  <a class="alert-link" href="http://flask.pocoo.org/docs/api/#flask.redirect">flask.redirect</a>,
  <a class="alert-link" href="http://flask.pocoo.org/docs/api/#flask.url_for">flask.url_for</a>.
</p>
